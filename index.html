<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WOI â€“ Mijn Personage</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    :root{ --bg:#0b1220; --card:#121a2b; --muted:#8aa0c7; --text:#e6eefc; --accent:#98e3ff; --ok:#86efac; --warn:#fde68a; }
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 80% -10%,#13203c 0%, #0b1220 60%) fixed;color:var(--text);font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:900px;margin:0 auto;padding:16px 16px 84px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 16px}
    h1{font-size:1.2rem;margin:0}
    .badge{font-size:.8rem;color:#0b1220;background:var(--accent);padding:4px 8px;border-radius:999px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px 16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .muted{color:var(--muted)}
    button{appearance:none;border:1px solid rgba(255,255,255,.2);background:transparent;color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    button.primary{background:var(--accent);color:#063245;border-color:transparent}
    .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .kpi{display:flex;gap:10px;align-items:baseline}
    .kpi b{font-size:1.1rem}
    details{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:8px 12px}
    details+details{margin-top:8px}
    summary{cursor:pointer;font-weight:600}
    .pill{display:inline-block;border:1px solid rgba(255,255,255,.25);padding:2px 8px;border-radius:999px;margin:2px 6px 0 0;font-size:.8rem}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .small{font-size:.9rem}
    .foot{position:fixed;left:0;right:0;bottom:0;padding:8px 12px;background:linear-gradient(0deg,rgba(11,18,32,.92),rgba(11,18,32,.6));backdrop-filter:blur(8px);border-top:1px solid rgba(255,255,255,.08)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.14);padding:6px 10px;border-radius:999px}
    .sep{height:1px;background:rgba(255,255,255,.08);margin:8px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>WOI â€“ Mijn Personage</h1>
      <span class="badge">PWA â€¢ Offline</span>
    </header>

    <div class="grid">
      <section class="card" id="profileCard">
        <h2 style="margin:.2rem 0 0">Jouw personage</h2>
        <div class="muted small">Je mag <b>alleen aan de startlocatie</b> een personage kiezen of wijzigen. Daarna wordt je keuze vastgezet.</div>
        <div id="pcInfo" style="margin-top:8px"></div>
        <div id="pcChooser" class="row small" style="margin-top:10px"></div>
        <div class="row" style="margin-top:10px">
          <button id="regenBtn">ğŸ² Willekeurig</button>
          <button id="savePcBtn" class="primary">âœ… Bevestig keuze</button>
          <button id="exportBtn">â¬‡ï¸ Exporteer voortgang</button>
        </div>
        <div class="sep"></div>
        <div class="small muted">Tip: installeer via menu (of knop hieronder) en open minstens Ã©Ã©n keer online; daarna werkt alles offline.</div>
      </section>

      <section class="card" id="statusCard">
        <h2>Locatiestatus</h2>
        <div class="row kpi"><div>ğŸ“ <b id="coords">â€”</b></div><div class="muted">(Â± <span id="acc">â€”</span> m)</div></div>
        <div class="row kpi"><div>ğŸ¯ Dichtstbijzijnde stop:</div><div><b id="closest">â€”</b></div></div>
        <div class="row kpi"><div>â†”ï¸ Afstand:</div><div><b id="dist">â€”</b> m</div></div>
        <div style="margin-top:8px" class="row">
          <button id="startBtn" class="primary">â–¶ï¸ Start locatie</button>
          <button id="stopBtn">â¸ï¸ Pauzeer</button>
          <button id="demoBtn">ğŸ§ª Demoâ€‘nabij</button>
        </div>
        <div id="permNote" class="small muted"></div>
      </section>
    </div>

    <section class="card" style="margin-top:12px">
      <h2>Ontgrendelde verhalen</h2>
      <div id="unlockList" class="small"></div>
    </section>

    <section class="card" style="margin-top:12px">
      <h2>Stops (overzicht)</h2>
      <div id="stopsList" class="small"></div>
    </section>
  </div>

  <div class="foot small">
    <div class="wrap" style="padding:0">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <span class="chip">ğŸ“¦ <span class="mono" id="cacheState">Niet geÃ¯nstalleerd</span></span>
          <span class="chip">ğŸ›°ï¸ <span class="mono" id="geoState">Inactief</span></span>
        </div>
        <div class="row">
          <button id="installHint">ğŸ“² Installeer app</button>
          <button id="resetBtn">ğŸ§¹ Reset app</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scenario data -->
  <script id="scenario-data" type="application/json">{
    "meta": {
      "title": "WOI â€“ Mijn Personage",
      "radiusDefaultMeters": 200,
      "startStopId": "start_menenpoort",
      "endStopId": "end_menenpoort",
      "requiredStops": ["new_irish_farm","langemark","tyne_cot","passchendaele_museum"]
    },
    "stops": [
      {"id":"start_menenpoort","naam":"Start: Menenpoort (Ieper)", "lat":50.851003, "lng":2.890939, "radius":140},
      {"id":"new_irish_farm","naam":"Stop 1: New Irish Farm Cemetery","lat":50.872890, "lng":2.897360, "radius":180},
      {"id":"langemark","naam":"Stop 2: Studentenfriedhof Langemark","lat":50.915300, "lng":2.916300, "radius":200},
      {"id":"tyne_cot","naam":"Stop 3: Tyne Cot Cemetery","lat":50.887000, "lng":2.999300, "radius":220},
      {"id":"passchendaele_museum","naam":"Stop 4: Memorial Museum Passchendaele","lat":50.898700, "lng":3.000700, "radius":180},
      {"id":"end_menenpoort","naam":"Einde: Menenpoort (Ieper)", "lat":50.851003, "lng":2.890939, "radius":140}
    ],
    "personages": [
      {"id":"aminata_diop","naam":"Aminata Diop","herkomst":"Saintâ€‘Louis, Senegal","rol":"Verpleegster (Rode Kruis)","bio":"Verzorgde gewonden in veldhospitalen rond Ieper.","verhalen":{
        "start_menenpoort":"Aminata leest namen en denkt aan families die ze hielp schrijven.",
        "new_irish_farm":"Ze herinnert zich Ierse jongens met loopgraafvoet; warme thee als medicijn.",
        "langemark":"Ze wisselde steriele doeken met een Duitse verpleger tijdens een korte wapenstilte.",
        "tyne_cot":"De aanvoer van gewonden leek eindeloos; ze deelde morfine spaarzaam.",
        "passchendaele_museum":"De vitrines lijken schoon; de geuren uit de verbandtent vergeet ze nooit.",
        "end_menenpoort":"Ze vouwt een brief dicht. â€˜Bedankt voor uw zoon,â€™ had ze ooit gedicteerd."
      }},
      {"id":"youssef_ben_salah","naam":"Youssef ben Salah","herkomst":"FÃ¨s, Marokko","rol":"Tirailleur (Frans)","bio":"Kwam in 1917 naar het Westelijk Front als versterking.","verhalen":{
        "start_menenpoort":"Hij voelt zich klein tussen duizenden namen.",
        "new_irish_farm":"Patrouilles door natte aarde; modder tot aan de knieÃ«n.",
        "langemark":"Hij ruilt brood voor woorden Duits; twee werelden, Ã©Ã©n honger.",
        "tyne_cot":"Munitie dragen onder vuur; vriend vermist.",
        "passchendaele_museum":"Een bajonet achter glas; hij weet hoe zwaar die voelt.",
        "end_menenpoort":"â€˜Dat ik het mocht overlevenâ€™ â€” zijn zacht uitgesproken wens."
      }},
      {"id":"stanislaw_nowak","naam":"StanisÅ‚aw Nowak","herkomst":"GaliciÃ«","rol":"Artilleriehelper","bio":"Boerenzoon met een liefde voor techniek.","verhalen":{
        "start_menenpoort":"De stilte klinkt als donder na regen.",
        "new_irish_farm":"Houwitsers verzetten: blaren in zijn handen.",
        "langemark":"Een Duitse melodie op viool; even geen schoten.",
        "tyne_cot":"Elke granaat een morele last die hij niet koos.",
        "passchendaele_museum":"Meetinstrumenten fascineren hem nog steeds.",
        "end_menenpoort":"Hij droomt dat hij ooit machines repareert, niet bedient."
      }},
      {"id":"margot_vandamme","naam":"Margot Vandamme","herkomst":"Ieper, BelgiÃ«","rol":"Burger â€“ brievenschrijfster","bio":"Schreef brieven voor gewonden die zelf niet meer konden.","verhalen":{
        "start_menenpoort":"Ze zoekt bekenden tussen de namen.",
        "new_irish_farm":"Ze leest een brief voor aan een Ierse jongen die lacht om haar accent.",
        "langemark":"Ze hoort zware stilte tussen zwarte kruisen.",
        "tyne_cot":"Ze bewaart een lintje dat ze kreeg van een Canadese verpleegster.",
        "passchendaele_museum":"Een veldfles identiek aan die van haar broer.",
        "end_menenpoort":"Ze legt het lintje neer. â€˜Voor allen,â€™ fluistert ze."
      }},
      {"id":"harinder_singh","naam":"Harinder Singh","herkomst":"Punjab, Brits-IndiÃ«","rol":"Sikh infanterist","bio":"Diende in het Britse leger, hield vast aan geloof en turban.","verhalen":{
        "start_menenpoort":"Hij groet in stilte.",
        "new_irish_farm":"De modder maakt geen onderscheid tussen naties.",
        "langemark":"Hij deelt chapatiâ€™s met een kamerad; smaak van thuis.",
        "tyne_cot":"Een kapotte turban, zorgvuldig herwonden.",
        "passchendaele_museum":"Een uniformpop kijkt hem aan; hij voelt de stof.",
        "end_menenpoort":"Hij bidt voor vriend en vijand."
      }},
      {"id":"elsa_stein","naam":"Elsa Stein","herkomst":"Keulen, Duitsland","rol":"Geneeskundestudente (vrijwilliger)","bio":"Kreeg opleiding in noodhospitaal net over de grens.","verhalen":{
        "start_menenpoort":"Ze denkt aan patiÃ«nten zonder paspoort, alleen pijn.",
        "new_irish_farm":"Ze oefent hechtingen op sinaasappels; vandaag op mensen.",
        "langemark":"Zwarte kruisen: haar accent weegt hier zwaar.",
        "tyne_cot":"Ze noteert koorts, pols, adem â€” routine tegen paniek.",
        "passchendaele_museum":"Ze bestudeert instrumenten en voelt weer trillende handen.",
        "end_menenpoort":"Genezen is vrede in kleine stukjes, leert ze."
      }},
      {"id":"mehmet_arslan","naam":"Mehmet Arslan","herkomst":"Ankara, Ottomaanse Rijk","rol":"Sappeur","bio":"Groef en timmerde, vaak dichterbij dan goed was.","verhalen":{
        "start_menenpoort":"Hij let op bakstenen en bogen.",
        "new_irish_farm":"Steunbalken kraken; hij vertrouwt zijn hamer.",
        "langemark":"Hij ruilt tabak voor spijkers.",
        "tyne_cot":"Ondergronds hoor je de oorlog anders.",
        "passchendaele_museum":"Een maquette van loopgraven â€“ hij weet hoe ze ruiken.",
        "end_menenpoort":"Hij hoopt op huizen, niet op holen."
      }},
      {"id":"hua_zheng","naam":"Hua Zheng","herkomst":"Shandong, China","rol":"Chinese Labour Corps","bio":"Arbeider aan wegen, sporen en logistiek.","verhalen":{
        "start_menenpoort":"Hij telt de bogen als was het meetwerk.",
        "new_irish_farm":"Kratten sjouwen; ritme als een lied.",
        "langemark":"Hij leert â€˜dank uâ€™ zeggen en lacht om zijn uitspraak.",
        "tyne_cot":"Kiezels recht leggen tussen witte stenen.",
        "passchendaele_museum":"Fotoâ€™s van werkploegen: hij zoekt bekenden.",
        "end_menenpoort":"Zijn handen willen bouwen, niet dragen."
      }},
      {"id":"aileen_omalley","naam":"Aileen Oâ€™Malley","herkomst":"Cork, Ierland","rol":"Veldtelefoniste","bio":"Onderhield lijnen onder gevaarlijk vuur.","verhalen":{
        "start_menenpoort":"Ze luistert naar de stad alsof het een lijn is.",
        "new_irish_farm":"Brekende verbinding; ze knoopt draden met koude vingers.",
        "langemark":"Een kort gesprek met een Duitse telefonist: â€˜Linie vrij?â€™.",
        "tyne_cot":"Stilte in de koptelefoon kan het hardst klinken.",
        "passchendaele_museum":"Een telefooncentrale die ruikt naar bakeliet en stof.",
        "end_menenpoort":"â€˜Lijn hersteld,â€™ fluistert ze, en hangt op."
      }},
      {"id":"marcel_dupont","naam":"Marcel Dupont","herkomst":"Lille, Frankrijk","rol":"Poilu (infanterist)","bio":"Doorstond de modder met droge humor.","verhalen":{
        "start_menenpoort":"Hij zet zijn kepi recht.",
        "new_irish_farm":"Brood met modderkorst; toch lachen.",
        "langemark":"Hij deelt een schets van thuis.",
        "tyne_cot":"Helmdeuken en schrammen als bladzijdes.",
        "passchendaele_museum":"Een gasmasker dat muf herinneringen ademt.",
        "end_menenpoort":"Hij schrijft eindelijk â€˜Ik kom terugâ€™."
      }},
      {"id":"anna_kowalska","naam":"Anna Kowalska","herkomst":"ÅÃ³dÅº, Polen","rol":"Chauffeuse (ambulance)","bio":"Reed gewonden over hobbelige wegen naar hulp.","verhalen":{
        "start_menenpoort":"Ze plant haar route in stilte.",
        "new_irish_farm":"Slippend vrachtje, zachte bochten om te sparen.",
        "langemark":"Ze stopt even voor een paard op de weg.",
        "tyne_cot":"Banden plakken bij maanlicht.",
        "passchendaele_museum":"Een ambulance in het museum, kleiner dan ze zich herinnert.",
        "end_menenpoort":"Motor uit. Eindelijk."
      }}
    ]
  }</script>

  <script>
  // Helpers
  function distanceMeters(a,b){const R=6371e3;const Ï†1=a.lat*Math.PI/180,Ï†2=b.lat*Math.PI/180;const dÏ†=(b.lat-a.lat)*Math.PI/180;const dÎ»=(b.lng-a.lng)*Math.PI/180;const s=Math.sin(dÏ†/2)**2+Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(dÎ»/2)**2;return 2*R*Math.asin(Math.sqrt(s));}
  const $=sel=>document.querySelector(sel);
  const store={get(){try{return JSON.parse(localStorage.getItem('woi_state')||'{}')}catch{return {}}},set(v){localStorage.setItem('woi_state',JSON.stringify(v))}};
  const DATA=JSON.parse(document.getElementById('scenario-data').textContent);
  const urlParams=new URLSearchParams(location.search);
  function pick(arr){return arr[Math.floor(Math.random()*arr.length)]}

  // Personage
  function ensureCharacter(){
    const st=store.get();
    const forced=urlParams.get('pcId')||urlParams.get('pc');
    if(forced&&DATA.personages.some(p=>p.id===forced)){st.pcId=forced;st.unlocked=st.unlocked||[];store.set(st);return st.pcId;}
    if(st.pcId&&DATA.personages.some(p=>p.id===st.pcId))return st.pcId;
    const pc=pick(DATA.personages);st.pcId=pc.id;st.unlocked=st.unlocked||[];store.set(st);return pc.id;
  }
  function currentPc(){const id=store.get().pcId;return DATA.personages.find(p=>p.id===id)}

  function renderProfile(){
    const pc=currentPc(); if(!pc) return;
    $('#pcInfo').innerHTML = `<div class="row">
      <div class="pill">ğŸ§‘ <b>${pc.naam}</b></div>
      <div class="pill">ğŸŒ ${pc.herkomst}</div>
      <div class="pill">ğŸ–ï¸ ${pc.rol}</div>
    </div><p class="muted">${pc.bio}</p>`;
    renderCharacterChooser();
  }
  function renderCharacterChooser(){
    const st=store.get();
    const chooser=$('#pcChooser');
    const options = DATA.personages.map(p=>`<option value="${p.id}" ${p.id===st.pcId?'selected':''}>${p.naam} â€” ${p.rol}</option>`).join('');
    const locked = !!st.lockedPc;
    const inside = window.__insideStart===true;
    chooser.innerHTML = `<select id=\"pcSelect\" ${locked?'disabled':''} ${!inside&&!locked?'disabled':''}>${options}</select>
      <span class=\"pill ${locked?'ok':''}\">${locked?'ğŸ”’ Keuze vergrendeld': (inside? 'ğŸŸ¢ Je kan hier je personage kiezen' : 'ğŸ” Kiesbaar enkel aan de start')}</span>`;
  }
  function renderStops(){ const cont=$('#stopsList'); cont.innerHTML=DATA.stops.map(s=>`<div class="pill">${s.naam}</div>`).join(''); }
  function renderUnlocked(){
    const st=store.get(); const pc=currentPc(); const cont=$('#unlockList');
    if(!st.unlocked||!st.unlocked.length){cont.innerHTML='<div class="muted">Nog niets ontgrendeld.</div>';return;}
    cont.innerHTML=st.unlocked.map(id=>{const stop=DATA.stops.find(s=>s.id===id);const txt=pc.verhalen[id];return `<details open><summary>ğŸ“˜ ${stop?.naam||id}</summary><div>${txt||'<span class=muted>(Geen tekst)</span>'}</div></details>`}).join('');
  }

  // Geoloc
  let watchId=null; window.__insideStart=false;
  function startWatch(){
    if(!('geolocation'in navigator)){ $('#permNote').textContent='Geen geolocatie'; return; }
    $('#geoState').textContent='Actief';
    watchId=navigator.geolocation.watchPosition(pos=>{
      const {latitude,longitude,accuracy}=pos.coords;
      $('#coords').textContent = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`; $('#acc').textContent=Math.round(accuracy);
      const here={lat:latitude,lng:longitude};
      let best=null; let insideStart=false;
      for(const s of DATA.stops){
        const d=Math.round(distanceMeters(here,{lat:s.lat,lng:s.lng}));
        if(!best||d<best.d) best={id:s.id,name:s.naam,d,radius:(s.radius||DATA.meta.radiusDefaultMeters)};
        if(s.id===DATA.meta.startStopId){ insideStart = d <= (s.radius||DATA.meta.radiusDefaultMeters); }
      }
      window.__insideStart = insideStart; renderCharacterChooser();
      if(best){ $('#closest').textContent=best.name; $('#dist').textContent=`${best.d}`; tryUnlock(best); }
      // Vergrendel keuze als we de startzone verlaten (Ã©Ã©nmalig)
      const st=store.get();
      if(!st.lockedPc && !insideStart){ st.lockedPc=true; store.set(st); renderCharacterChooser(); toast('ğŸ”’ Personage vergrendeld'); }
    }, err=>{ $('#permNote').innerHTML='<span class="warn">Locatie geweigerd</span>'; $('#geoState').textContent='Uit'; }, {enableHighAccuracy:true,maximumAge:10000,timeout:15000});
  }
  function stopWatch(){ if(watchId!==null){ navigator.geolocation.clearWatch(watchId); watchId=null; $('#geoState').textContent='Inactief'; } }

  function tryUnlock(best){
    if(best.d<=best.radius){
      const st=store.get(); st.unlocked=st.unlocked||[];
      if(best.id===DATA.meta.endStopId){
        const req = new Set(DATA.meta.requiredStops);
        const haveAll = [...req].every(id=>st.unlocked.includes(id));
        if(!haveAll){ return; }
      }
      if(!st.unlocked.includes(best.id)){
        st.unlocked.push(best.id); store.set(st);
        renderUnlocked(); toast(`âœ… Ontgrendeld: ${best.name}`);
      }
    }
  }

  // UI helpers
  let toastTimer; function toast(msg){ clearTimeout(toastTimer); let t=document.getElementById('toast'); if(!t){ t=document.createElement('div'); t.id='toast'; document.body.appendChild(t);} t.textContent=msg; Object.assign(t.style,{position:'fixed',left:'50%',bottom:'76px',transform:'translateX(-50%)',background:'rgba(0,0,0,.75)',color:'#fff',padding:'10px 14px',borderRadius:'12px',zIndex:9999}); toastTimer=setTimeout(()=>{t.remove()},2600); }
  function exportProgress(){ const st=store.get(); const pc=currentPc(); const lines=[]; lines.push(`# ${DATA.meta.title}`); lines.push(`Personage: ${pc.naam} (${pc.herkomst}) â€“ ${pc.rol}`); lines.push(''); for(const id of (st.unlocked||[])){ const stop=DATA.stops.find(s=>s.id===id); lines.push(`## ${stop?.naam||id}`); lines.push(pc.verhalen[id]||'(geen tekst)'); lines.push(''); } const blob=new Blob([lines.join('\n')],{type:'text/markdown'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='woi-voortgang.md'; a.click(); URL.revokeObjectURL(url); }
  function hardReset(){ localStorage.removeItem('woi_state'); location.reload(); }

  // Events
  document.getElementById('startBtn').addEventListener('click',startWatch);
  document.getElementById('stopBtn').addEventListener('click',stopWatch);
  document.getElementById('regenBtn').addEventListener('click',()=>{ const st=store.get(); if(st.lockedPc && !window.__insideStart){ toast('ğŸ”’ Je kan je personage niet wijzigen buiten de startzone.'); return; } delete st.pcId; store.set(st); ensureCharacter(); renderProfile(); renderUnlocked(); toast('Nieuw personage gekozen'); });
  document.getElementById('savePcBtn').addEventListener('click',()=>{ const st=store.get(); if(st.lockedPc && !window.__insideStart){ toast('ğŸ”’ Personage wijzigen kan enkel aan de start.'); return; } if(!window.__insideStart){ toast('ğŸ” Ga naar de startlocatie om te kiezen.'); return; } const sel=document.getElementById('pcSelect'); if(sel){ st.pcId=sel.value; store.set(st); renderProfile(); toast('âœ… Personage bevestigd'); } });
  document.getElementById('exportBtn').addEventListener('click',exportProgress);
  document.getElementById('resetBtn').addEventListener('click',hardReset);
  document.getElementById('demoBtn').addEventListener('click',()=>{ const s=DATA.stops.find(x=>x.id===DATA.meta.requiredStops[0])||DATA.stops[0]; tryUnlock({id:s.id,name:s.naam,d:0,radius:(s.radius||DATA.meta.radiusDefaultMeters)}); });

  // Install prompt
  let deferredPrompt=null; window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;const b=document.getElementById('installHint'); b.textContent='ğŸ“² Installeer app'; b.classList.add('primary');});
  document.getElementById('installHint').addEventListener('click',async()=>{ if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; } else { alert('Installeer via browser-menu: Chrome: â‹® â†’ Toevoegen aan startscherm. Safari: deelâ€‘icoon â†’ Zet op beginscherm.'); } });

  // Service worker registratie
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js',{scope:'./'}).then(()=>{ $('#cacheState').textContent='GeÃ¯nstalleerd'; }).catch(()=>{ $('#cacheState').textContent='Niet geÃ¯nstalleerd'; }); }

  // Init
  ensureCharacter(); renderProfile(); renderStops(); renderUnlocked();
  </script>
</body>
</html>
